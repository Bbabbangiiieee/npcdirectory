<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>NPC MINGEN Directory</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="./assets/img/napocorlogo.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    integrity="sha512-..." crossorigin="anonymous" />


  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- JAVASCRIPT -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script defer src="bundle.js"></script>
</head>

<body class="index-page" data-bs-spy="scroll" data-bs-target="#navmenu">
  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">
    <div class="container-fluid d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <img src="./assets/img/napocorlogo.png" alt="NPC Logo">
        <h1 style="color: blue;">ISTD</h1>

        <span>Project</span>
      </a>
      <!-- Nav Menu -->
      <nav id="navmenu" class="navmenu">
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <div class="search-container">
        <input type="text" id="search" placeholder="Search..." oninput="searchMembers()">
        <button id="search-button" type="button"><i class="fas fa-search"></i></button>
      </div>

      <div>
        <a href="login.html">
          <button type="button" class="btn btn-primary waves-effect waves-light">
            Login <i class="fas fa-arrow-alt-circle-right"></i>
          </button>
        </a>
      </div>

      <!-- End Nav Menu -->
    </div>
  </header>

  <!-- End Headers -->

  <main id="main">

    <!-- Hero Section - Home Page -->
    <section id="hero" class="hero">
      <img src="./assets/img/mingen3.png" alt="background" data-aos="fade-in">
      <div class="container">
        <div class="row">
          <div class="col-lg-10">
            <h2 data-aos="fade-up" data-aos-delay="100">Welcome to NPC Mindanao Generation Directory</h2>
            <p data-aos="fade-up" data-aos-delay="200">
              Providing a comprehensive and organized listing of contact information essential for seamless
              communication within the organization.</p>
          </div>
          <div class="col-lg-5">
          </div>
        </div>
      </div>

    </section>
    <!-- End Hero Section -->

    <!-- Services Section - Home Page -->
    <section id="services" class="services">

      <!--  Section Title -->
      <div class="container section-title" data-aos="fade-up">
        <h2>Departments & Divisions </h2>
        <p>Refers to the organizational structure within NPC, delineating specific areas of focus and responsibilities
          to efficiently manage tasks and functions.</p>
      </div><!-- End Section Title -->

      <div class="container">

        <div class="row gy-4" id="deptList">
        </div>
      </div>

    </section><!-- End Services Section -->

    <div class="row m-5" id="list">

    </div>

    <!-- No Results -->
    <section id="no-results-section" style="display: none;">
      <br>
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-xl-10">
            <div class="text-center">
              <h3>No Results !!</h3>
              <p>Sorry, there is nothing of that in the directory.</p>
              <a class="cta-btn" href="index.html">Go to Homepage</a>
            </div>
          </div>
        </div>
      </div>

    </section><!-- End Call-to-action Section -->

    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
      <div class="container copyright text-center mt-4">
        <p>&copy; <span> 2023 MinGen Telephone Directory</span> <strong class="px-1">(as of JAN)</strong>
          <br> <span>ISTD TELECOMM</span>
        </p>
        <div class="credits">
          <h5>Oh give thanks to the LORD, for He is good; for His steadfast love endures forever! </h5>
          <h6><i>1 Chronicles 16:34</i></h6>
        </div>

      </div>
    </footer>

    <!-- End Footer -->



    <div class="nav-buttons">
    </div>

    <!-- Scroll Top Button -->
    <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
        class="bi bi-arrow-up-short"></i></a>
    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>


    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
      import {
        getFirestore,
        collection,
        getDocs,
        query,
        where,
        orderBy,
        deleteDoc,
        onSnapshot
      } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCAScRRCt3vkzG9kbaaVlwn1S6R2PkSZt8",
        authDomain: "npc-directory-fe968.firebaseapp.com",
        projectId: "npc-directory-fe968",
        storageBucket: "npc-directory-fe968.appspot.com",
        messagingSenderId: "405924419354",
        appId: "1:405924419354:web:886dbdd295db21d008bea3"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const analytics = getAnalytics(app);
      const auth = getAuth();
      console.log(app);
      document.addEventListener('DOMContentLoaded', function () {

        getDocs(collection(db, "Department"))
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              let data = doc.data();
              let department = data.dept;

              // Clear existing content
              let deptList = $('#deptList');
              let navButtons = $('.nav-buttons');

            
              // Create section header
              let deptSection = `
                <div class="col-lg-6 " data-aos="fade-up" data-aos-delay="100">
                  <div class="service-item d-flex">
                    <div>
                      <h4 class="title"><a href="index.html#team" class="stretched-link">${data.dept_name}</a></h4>
                      <p class="description">${data.description}</p>
                    </div>
                  </div>
                </div>
                    `;

              // Append section header to contact list
              deptList.append(deptSection);

              let navButton = `<a href="#${data.dept_name}" class="nav-button"><span>${data.dept_name.substring(0, 3)}</span></a>`
              navButtons.append(navButton);
            })
          })
          .catch((error) => {
            console.error("Error fetching documents: ", error);
          });

        // Function to fetch data from Firestore and populate contacts grouped by department
        function fetchData() {
          getDocs(collection(db, "Contacts"))
            .then((querySnapshot) => {
              let contactsByDepartment = {};

              querySnapshot.forEach((doc) => {
                let data = doc.data();
                let department = data.dept;

                // Initialize the department array if it doesn't exist
                if (!contactsByDepartment[department]) {
                  contactsByDepartment[department] = [];
                }

                // Push the contact data into the respective department array
                contactsByDepartment[department].push({
                  id: doc.id,
                  name: data.name,
                  profile: data.profile,
                  position: data.position,
                  cisco_tel: data.cisco_tel,
                  fax_tel: data.fax_tel,
                  lan_tel: data.lan_tel,
                  local_num: data.local_num
                });
              });

              // Clear existing content
              let contactList = $('#list');
              contactList.empty();

              // Iterate over departments and render each section
              for (let department in contactsByDepartment) {
                let departmentContacts = contactsByDepartment[department];

                // Create section header
                let section = `
                        <div class="col-lg-12 text-center mb-2" id="${department}">
                            <hr style="border-top: 2px solid #ff0000;">
                            <h4>${department}</h4>
                            <hr style="border-top: 2px solid #ff0000;">
                        </div>
                    `;

                // Append section header to contact list
                contactList.append(section);

                // Render contacts under this department
                departmentContacts.forEach((contact) => {
                  let contactHtml = `
                        <div class="col-xl-3 col-sm-6 grid">
                            <div class="card text-center">
                                <div class="card-body">
                                    <div class="mb-4">
                                        <img class="rounded-circle avatar-sm" src="${contact.profile}" alt="">
                                    </div>
                                    <h5 class="font-size-15 mb-1 name">${contact.name}</h5>
                                    <p class="text-muted">${department}</p>
                                    <div>
                                        <a href="javascript: void(0);" class="badge bg-primary font-size-11 m-1">${contact.position}</a>
                                    </div>`;

                  // Conditionally render Cisco Telepresence if available
                  if (contact.cisco_tel) {
                    contactHtml += `
                            <div class="mt-1 ms-3" style="text-align:left !important;">
                                <h6 class="mb-1 name">Cisco Telepresence: <span class="text-muted">&nbsp; ${contact.cisco_tel}</span></h6>
                            </div>`;
                  }

                  // Conditionally render Fax if available
                  if (contact.fax_tel) {
                    contactHtml += `
                            <div class="mt-1 ms-3" style="text-align:left !important;">
                                <h6 class="mb-1 name">Fax: <span class="text-muted">&nbsp; ${contact.fax_tel}</span></h6>
                            </div>`;
                  }

                  // Conditionally render Landline if available
                  if (contact.lan_tel) {
                    contactHtml += `
                            <div class="mt-1 ms-3" style="text-align:left !important;">
                                <h6 class="mb-1 name">Landline: <span class="text-muted">&nbsp; ${contact.lan_tel}</span></h6>
                            </div>`;
                  }

                  // Conditionally render Local Number if available
                  if (contact.local_num) {
                    contactHtml += `
                            <div class="mt-1 ms-3" style="text-align:left !important;">
                                <h6 class="mb-1 name">Local Number: <span class="text-muted">&nbsp; ${contact.local_num}</span></h6>
                            </div>`;
                  }

                  contactHtml += `
                                </div>
                                <div class="card-footer bg-transparent border-top">
                                    <div class="contact-links d-flex font-size-20">
                                        <div class="ms-auto">
                                            <a href="edit_contact.html?d=${contact.id}" class="btn btn-warning">
                                                <i class="fas fa-pen text-white"></i>
                                            </a>
                                        </div>
                                        <div class="ms-2">
                                            <button type="button" class="btn btn-danger delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                  // Append contact HTML to the corresponding section
                  $('#list').append(contactHtml);
                });

              }
            })
            .catch((error) => {
              console.error("Error fetching documents: ", error);
            });
        }


        // Function to filter contacts based on search input
        function searchMembers() {
          // Get search input value
          let searchQuery = document.getElementById('search').value.toLowerCase();
          console.log(searchQuery);

          // Fetch data again to ensure all contacts are available
          fetchData();

          // Filter contacts based on search query
          let filteredContacts = [];
          setTimeout(() => { // Add a slight delay to ensure DOM elements are rendered
            filteredContacts = Array.from(document.querySelectorAll('.grid')).filter(contact => {
              console.log('contact', contact);
              let contactName = contact.querySelector('.name').textContent.toLowerCase();
              return contactName.includes(searchQuery);
            });

            // Show/hide contacts based on search results
            Array.from(document.querySelectorAll('.hero')).forEach(contact => {
              contact.style.display = filteredContacts.includes(contact) ? 'block' : 'none';
            });
            Array.from(document.querySelectorAll('.services')).forEach(contact => {
                contact.style.display = filteredContacts.includes(contact) ? 'block' : 'none';
            });
            Array.from(document.querySelectorAll('.section-title')).forEach(contact => {
                contact.style.display = filteredContacts.includes(contact) ? 'block' : 'none';
            });
            Array.from(document.querySelectorAll('.grid')).forEach(contact => {
                contact.style.display = filteredContacts.includes(contact) ? 'block' : 'none';
            });
          }, 500);
        }

        // Attach searchMembers function to the window object
        window.searchMembers = searchMembers;

        // Initialize Firebase and fetch data initially
        const unsubscribe = onSnapshot(collection(db, "Contacts"), (snapshot) => {
          fetchData();
        });
      });

    </script>


</body>

</html>

<script>

  function searchMembers() {
    var searchTerm = document.getElementById('search').value.trim().toLowerCase();
    var teamSection = document.getElementById('team');
    var istdSection = document.getElementById('istd');
    var servicesSection = document.getElementById('services');
    var heroSection = document.getElementById('hero');
    var noResultsSection = document.getElementById('no-results-section');

    if (searchTerm === '') {
      // If the search term is empty, show all sections and hide the "no results" section
      teamSection.style.display = 'block';
      istdSection.style.display = 'block';
      servicesSection.style.display = 'block';
      heroSection.style.display = 'block';
      noResultsSection.style.display = 'none';
    } else {
      var allMembers = document.querySelectorAll('.member');
      var hasResults = false;

      allMembers.forEach(function (member) {
        var memberInfoCenter = member.querySelector('.member-info.text-center');
        var memberInfoLeft = member.querySelector('.member-info.text-left');

        var memberTextCenter = memberInfoCenter ? memberInfoCenter.textContent.toLowerCase() : '';
        var memberTextLeft = memberInfoLeft ? memberInfoLeft.textContent.toLowerCase() : '';

        if (memberTextCenter.includes(searchTerm) || memberTextLeft.includes(searchTerm)) {
          member.style.display = 'block';
          hasResults = true;
        } else {
          member.style.display = 'none';
        }
      });

      if (!hasResults) {
        servicesSection.style.display = 'none';
        heroSection.style.display = 'none';
        teamSection.style.display = 'none';
        istdSection.style.display = 'none';
        noResultsSection.style.display = 'block';
      } else {
        servicesSection.style.display = 'none';
        heroSection.style.display = 'none';
        noResultsSection.style.display = 'none';

        // Check if the result is in the team or istd section and show the respective section
        var teamResults = teamSection.querySelectorAll('.member[style="display: block;"]').length;
        var istdResults = istdSection.querySelectorAll('.member[style="display: block;"]').length;

        if (teamResults > 0 && istdResults === 0) {
          teamSection.style.display = 'block';
          istdSection.style.display = 'none';
        } else if (istdResults > 0 && teamResults === 0) {
          istdSection.style.display = 'block';
          teamSection.style.display = 'none';
        }
      }
    }
  }


</script>